pdi:
  metadata:
    nx: int #globle ng
    ny: int
    nz: int
    max_iter: int
    frequency: int
    iter: int
    ghost_depth: int
    time_out: double
    current_time: double
    mpi_rank: int
    mpi_size: int


  data:
    rho: { type: array, subtype: double, size: ['$nx/$mpi_size+2*$ghost_depth', '$ny', '$nz'] }
    u: { type: array, subtype: double, size: ['$nx/$mpi_size+2*$ghost_depth', '$ny', '$nz'] }
    P: { type: array, subtype: double, size: ['$nx/$mpi_size+2*$ghost_depth', '$ny', '$nz'] }

  plugins:
    mpi:
    decl_hdf5:
      - file: test_${iter}.h5
        collision_policy: write_into
        communicator: '$MPI_COMM_WORLD'
        on_event: write_file
        datasets:
          rho: {type: array, subtype: double, size: ['$nx', '$ny', '$nz'] }
          u: {type: array, subtype: double, size: ['$nx', '$ny', '$nz'] }
          P: {type: array, subtype: double, size: ['$nx', '$ny', '$nz'] }
        write:
          rho:
            memory_selection:
              size: ['$nx/$mpi_size', '$ny', '$nz']
              start: ['$ghost_depth', 0, 0]
            dataset_selection:
              size: ['$nx/$mpi_size', '$ny', '$nz']
              start: ['$mpi_rank*$nx/$mpi_size', 0, 0]
          u:
            memory_selection:
              size: ['$nx/$mpi_size', '$ny', '$nz']
              start: ['$ghost_depth', 0, 0]
            dataset_selection:
              size: ['$nx/$mpi_size', '$ny', '$nz']
              start: ['$mpi_rank*$nx/$mpi_size', 0, 0]
          P:
            memory_selection:
              size: ['$nx/$mpi_size', '$ny', '$nz']
              start: ['$ghost_depth', 0, 0]
            dataset_selection:
              size: ['$nx/$mpi_size', '$ny', '$nz']
              start: ['$mpi_rank*$nx/$mpi_size', 0, 0]
    # trace:
